\section{Analisi}
\label{sec:analisi}
In questa sezione verrà effettuata un'analisi sui risultati mediati su 30 simulazioni,
comparando il modello base con il modello esteso e infine con un modello allo stato dell'arte.

\subsection{Modello Base}
Nelle figure \ref{fig:analisi-base-evacuated} e \ref{fig:analisi-base-casualties} vengono mostrate le percentuali di evacuati
e di morti nel tempo al variare del numero di auto e pedoni.
%
Come si può notare dalla figura \ref{fig:analisi-base-evacuated}, il numero di pedoni non influenza la percentuale di pedoni evacuati nel tempo.
%
Per quanto riguarda le auto, più è alto il numero di auto più tempo è richiesto per evacuare e inoltre più bassa è la percentuale di auto evacuate alla fine della simulazione.
%
Osservando la percentuale di evacuati totali si può notare che un numero minore di auto permette di evacuare il numero maggiore di agenti.
I casi con probabilità di pedoni del 75\% e 100\% si ottiene la stessa percentuale massima di agenti evacuati,
tuttavia il caso con probabilità 75\% ha un andamento più veloce per la presenza delle auto.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{images/analisi/base-evacuated.png}
    \caption{Percentuale degli evacuati nel tempo al variare del numero di agenti con il modello base.}
    \label{fig:analisi-base-evacuated}
\end{figure}

Per quanto riguarda le percentuali di mortalità (Fig. \ref{fig:analisi-base-casualties}), possono essere fatte analisi simili a quelle in precendenza
per il numero di evacuati.
Per i pedoni in tutti i casi la percentuale di vittime rimane sotto al 2\%, mentre osservando le auto e le vittime totali
risulta una mortalità maggiore all'aumentare del numero di auto fino a un massimo di circa 50\%.
I casi con meno vittime sono con una probabilità di auto del 25\% e il caso solo pedoni che hanno risultati molto simili.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{images/analisi/base-casualties.png}
    \caption{
        Percentuale delle vittime nel tempo al variare del numero di agenti con il modello base.
        %
    }
    \label{fig:analisi-base-casualties}
\end{figure}

Nella figura \ref{fig:analisi-base-evtimes} vengono riportate le percentuali di agenti evacuati nel tempo e il tempo in cui evacuano in media.
%
Nel caso con solo pedoni si ha un enorme picco al tempo medio di X minuti e all'aumentare del numero di auto
il tempo medio di evacuzione si abbassa fino a X minuti nel caso con solo auto.

Nel caso con probabilità di auto del 25\% sembra formarsi un secondo picco più basso nei primi minuti probabilmente dovuto alle auto, mentre il secondo ai pedoni.
Questi picchi tendono ad appiattirsi con l'aumentare del numero di auto.

Inoltre si può notare come con un numero maggiore di auto considerate minore è la percentuale di agenti che evacuano negli ultimi minuti.
Questo poichè, come già evidenziato nella figura \ref{fig:analisi-base-evacuated}, le auto evacuano più velocemente dei pedoni.

\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{images/analisi/base-evtimes.png}
    \caption{
        Distribuzione del tempo di evacuzione in percentuale al variare del numero di agenti e tempo medio di evacuazione.
    }
    \label{fig:analisi-base-evtimes}
\end{figure}

\pagebreak

\subsection{Modello Esteso}
Nonostante l'introduzione della variazione della velocità per i pedoni,
la percentuale di pedoni evacuati risulta molto simile al variare del numero di pedoni (Fig. \ref{fig:analisi-new-evacuated}).
Si può notare una piccola differenza tra il minuto 30 e il minuto 40 per il caso con solo pedoni.

Il caso con una percentuale di auto evacuate maggiore è quello con una probabilità di auto del 25\%.
Il caso con solo auto, al contrario di come si possa pensare, non è il caso peggiore e ha un numero di evacuati simile ai casi
con probabilità di auto di 75\% e 50\%.

In generale il numero di auto evacuate è molto più basso rispetto a quello dei pedoni.

Considerando i contributi di auto e pedoni, al diminuire del numero di auto considerate cresce il numero totale di evacuati alla fine della simulazione,
fino al caso migliore con solo pedoni.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{images/analisi/new-evacuated.png}
    \caption{Percentuale degli evacuati nel tempo al variare del numero di agenti con il modello esteso.}
    \label{fig:analisi-new-evacuated}
\end{figure}

Anche per le percentuali di morti figura \ref{fig:analisi-new-casualties} analisi simili alle percentuali di evacuati \ref*{fig:analisi-new-evacuated}
possono essere fatte.
%
Si può vedere come al variare del numero di pedoni considerati non ci siano differenze significative,
mentre per le auto la percentuale di vittime sale al crescere del numero di auto considerate.

In generale la percentuale di vittime per le auto è molto più alta rispetto a quella dei pedoni,
con un massimo di circa X\% nel caso con una probabilità di auto del 75\%, con una mortalità superiore anche al caso solo auto.
%
Il numero di vittime totali cresce al crescere del numero di auto e il caso con solo auto è quello con la percentuale di mortalità maggiore.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{images/analisi/new-casualties.png}
    \caption{Percentuale delle vittime nel tempo al variare del numero di agenti con il modello esteso.}
    \label{fig:analisi-new-casualties}
\end{figure}

\pagebreak

Nella figura \ref{fig:analisi-new-evtimes} vengono riportate le percentuali di agenti evacuati nel tempo
e il tempo in cui evacuano in media.
%
In modo analogo al modello base il tempo medio di evacuazione si abbassa e sembrano formarsi due picchi nel caso con una probabilità di auto del 25\% per poi appiattirsi
all'aumentare del numero di auto.


\begin{figure}
    \centering
    \includegraphics[width=\textwidth]{images/analisi/new-evtimes.png}
    \caption{Distribuzione del tempo di evacuzione in percentuale al variare del numero di agenti e tempo medio di evacuazione.}
    \label{fig:analisi-new-evtimes}
\end{figure}

\pagebreak

\subsection{Comparazione Modello Base e Modello Esteso}
In questa sottosezione verrano comparati il modello base e il modello esteso analizzando
le percentuali di evacuati e di vittime per poi passare a comparazioni spaziali,
in particolare mostrando l'effetto della gestione delle intersezioni durante la simulazione.

\subsubsection*{Percentuale di Evacuati e di Vittime}

\begin{figure}[ht]
    \centering
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-total-evacuated.png}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-total-casualties.png}
    \end{subfigure}
    \caption{Comparazione tra modello base e modello esteso delle percentuali di evacuati (sinistra) e di vittime (destra) al variare del numero di agenti.}
    \label{fig:analisi-comparison-total-ec}
\end{figure}

Osservando la figura \ref{fig:analisi-comparison-total-ec} è possibile comparare le percentuali di evacuati e di vittime nel tempo al variare del numero di agenti tra i due modelli.
In generale il modello esteso presenta un numero minore di evacuati e un numero maggiore di vittime rispetto al modello base.
Questo può essere sintomo dell'effetto delle intersezioni che creando rallentamenti causano una mortalità maggiore,
infatti la percentuale di evacuati del modello esteso presenta un andamento più lento rispetto al modello di partenza.
Per entrambi i modelli la percentuale di evacuati decresce e la percentuale di vittime cresce all'aumentare del numero di auto considerate.
Inoltre per entrambi i modelli le prime vittime si verificano dopo 40 min.
Gli unici casi in cui il modello esteso e quello base hanno risultati molto simili sono il caso con solo pedoni e il caso solo auto,
ovvero i casi in cui l'effetto delle intersezioni è minimo.

\pagebreak

\subsubsection*{Percentuale di Evacuati nel Tempo}

Come già detto in precedenza le distribuzioni della percentuale di evacuati nel tempo del modello base e del modello esteso
presentano un andamento simile (Fig. \ref{fig:analisi-comparison-evtimes}). Il tempo medio di evacuazione abbastanza simile per i due modelli,
leggermente più alto per il modello esteso con una probabilità di pedoni di 75\%.

\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\textwidth]{images/analisi/comparison-evtimes.png}
    \caption{Comparazione delle distribuzioni dei tempi di evacuazione al variare del numero di agenti.}
    \label{fig:analisi-comparison-evtimes}
\end{figure}

\pagebreak

\subsubsection*{Tempo Impiegato per Evacuare}
Un' ulteriore comparazione riguarda il tempo impiegano auto e pedoni per evacuare.
Come mostrato nella figura \ref{fig:analisi-comparison-evtimes2} per quanto riguarda le auto, il modello base presenta un andamento descresente per il tempo medio richiesto per evacuare al diminuire del numero di auto considerate.
Le auto impiegano in media tempi maggiori con il modello esteso rispetto a quello base.
%
I pedoni invece non presentano alcun cambiamento significativo al variare del numero di agenti e del modello considerato.

Per entrambi i modelli un pedone impiega in media un tempo di 21 minuti per evacuare e un massimo di 36 minuti.
Per le auto invece il tempo medio di evacuazione per il modello base è 10 minuti e per il modello esteso 16 minuti,
con tempi massimi rispettivamente di 32 e 42 minuti.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{images/analisi/comparison-evtimes2.png}
    \caption{
        Comparazione dei tempi di evacuazione al variare del numero di agenti e nel caso medio distinti per auto (sopra) e pedoni (sotto).
    }
    \label{fig:analisi-comparison-evtimes2}
\end{figure}

\pagebreak

La figura \ref{fig:analisi-comparison-ev-times-map} mostra i tempi di evacuazione mediati tra gli agenti che partono dallo stesso nodo della rete,
mediati a loro volta tra tutte le configurazioni di auto e pedoni.

In generale gli agenti che partono dalla costa impiegano più tempo rispetto agli altri che sono più vicini ai rifugi.

Confrontando i pedoni al variare del modello usato non si riscontrano cambiamenti significativi nei tempi di evacuazione.
Mentre nel caso delle auto si nota che il modello esteso introduca dei rallentamenti rispetto al modello base, soprattuto lungo la costa.

\begin{figure}[ht]
    \centering
    \includegraphics[width=\textwidth]{images/analisi/comparison-evtimes-map.png}
    \caption{Comparazione dei tempi di evacuazione mediati tra gli agenti che partono dallo stesso nodo della rete. }
    \label{fig:analisi-comparison-ev-times-map}
\end{figure}

\pagebreak


% \subsubsection*{Strade Critiche}
% Un'ulteriore analisi per valutare l'effetto dell'estensione del modello è quella di evidenziare in quali strade si verificano 
% più vittime al variare del numero di auto e pedoni. 
% %
% Nella figura \ref{fig:analisi-comparison-critical-links1} viene mostrato come si distribuisce la percentuale di mortalità nelle strade 
% al variare del numero di auto e pedoni e riportata la percentuale media. 

% Il modello base (Fig. \ref{fig:base-link-casualties}) nei casi con un numero di auto minore o uguale al 50\%
% non presenta differenze significative e si hanno tante strade con una percentuale bassa di vittime, 
% mentre negli altri due casi ci sono poche strade con una percentuale alta.

% Il modello esteso (Fig. \ref{fig:new-link-casualties}) invece presenta una strada comune per tutti casi 
% in cui sono presenti delle auto che contribuisce a più del 50\% delle vittime.
% %
% In generale in tutti i casi la maggior parte delle strade con più vittime sono diverse tra i due modelli a eccezione del caso 
% 100\% pedoni.
% %
% Le strade segnate come critiche corrispondono a quelle con una percentuale media maggiore del 5\% e sono mostrate nella figura \ref{fig:analisi-comparison-critical-links2}.

% \begin{figure}[ht]
%     \centering
%     \includegraphics[width=0.8\textwidth]{images/analisi/casualties-map.png}
%     \caption{strade critiche trovate per i due modelli.}
%     \label{fig:analisi-comparison-critical-links2}
% \end{figure}

% \newpage

% \begin{figure}[ht]
%     \centering
%     \begin{subfigure}{0.475\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{images/analisi/base_links_casualties}
%         \caption{Modello base}
%         \label{fig:base-link-casualties}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}{0.475\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{images/analisi/new_links_casualties}
%         \caption{Modello esteso}
%         \label{fig:new-link-casualties}
%     \end{subfigure}
%     \caption{Comparazione delle percentuali di mortalità nelle strade al variare del numero di auto e pedoni.}
%     \label{fig:analisi-comparison-critical-links1}
% \end{figure}


\newpage

\subsection{Analisi Intersezioni}
In questa sottosezione verranno descritte le analisi effettuate sulle intersezioni per valutare l'effetto dell'estesione
del modello. Per ogni intersezione sono stati analizzati la percentuale di vittime e il flusso in entrata e in uscita, comparando
i due modelli. Inoltre solo per il modello esteso sono stati analizzati anche i tempi medi di attesa nelle intersezioni,
poichè nel modello base non c'è attesa.

\subsubsection*{Percentuale di Vittime}
Nella figura \ref{fig:analisi-comparison-critical-ints1} vengono mostrate le percentuali di mortalità nelle intersezioni gestite per i due modelli al variare del numero di
agenti e il caso mediato. Inoltre le intersezioni sono ordinate per distanza crescente dal mare.

La percentuale di vittime in un'intersezione è il numero di vittime su ogni strada in entrata nell'intersezione sul numero di vittime totale.

In generale le intersezioni hanno una percentuale di mortalità non superiore al 10\%.
Nei casi con solo pedoni e solo auto i risultati sono molto simili.


\begin{figure}[ht]
    \centering
    \begin{subfigure}{0.475\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-critical-ints-base.png}
        \caption{Modello base}
        \label{fig:base-ints-casualties}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.475\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-critical-ints-new.png}
        \caption{Modello esteso}
        \label{fig:new-ints-casualties}
    \end{subfigure}
    \caption{%
        Comparazione delle percentuali di mortalità nelle intersezioni al variare del numero di auto e pedoni.
        Le intersezioni sono ordinate per distanza crescente dal mare.
    }
    \label{fig:analisi-comparison-critical-ints1}
\end{figure}

Per quanto riguarda il caso con probabilità di auto del 75\%, entrambi i modelli condividono valori relativamente alti di mortalità per molte intersezioni,
ma nel modello esteso risultano leggermente più bassi.

Nei casi con probabilità di auto del 50\% e del 25\% il modello esteso ha una percentuale di mortalità distribuita su più intersezioni.

Come si può notare dall'ordine delle intersezioni (Fig. \ref{fig:analisi-comparison-critical-ints1}), i casi con più pedoni
hanno più vittime nelle intersezioni più distanti, mentre i casi con più auto hanno più vittime nelle intersezioni più vicine al mare per
via delle code che si formano in caso di congenstione.

In media le percentuali di mortalità per i due modelli risultato simili come si può vedere anche nella figura \ref{fig:analisi-comparison-critical-ints2}.


\begin{figure}[ht]
    \centering
    \begin{subfigure}{0.475\textwidth}
        \includegraphics[width=\textwidth]{images/analisi/base_critical_ints_map.png}
        \caption{Modello base}
    \end{subfigure}
    \hfill
    \begin{subfigure}{0.475\textwidth}
        \includegraphics[width=\textwidth]{images/analisi/new_critical_ints_map.png}
        \caption{Modello esteso}
    \end{subfigure}
    \caption{Percentuali di vittime medie per ogni intersezione distinte per tipo: TWSC (quadrati), AWSC (triangoli).}
    \label{fig:analisi-comparison-critical-ints2}
\end{figure}

Nella figura \ref{fig:analisi-comparison-critical-ints2} vengono mostrate le percentuali di vittime nella rete
distinte in base al tipo di intersezione: TWSC, AWSC.

% TODO: commenti su TWSC, AWSC...

\subsubsection*{Flusso}
Per ogni intersezione è stato calcolato il flusso in entrata e in uscita sommando i valori di ogni strada al variare del numero di auto e pedoni.

Come si nota nella figura \ref{fig:analisi-comparison-in-out-flow-ped},
il flusso dei pedoni non presenta particolari differenze tra modello base ed esteso, nonostante le modifiche apportate ai pedoni.

Per entrambi i modelli il flusso in entrata e in uscita in ogni intersezione è molto simile.
Inoltre all'aumentare del numero di pedoni c'è un incremento nel flusso.

Nella maggior parte dei casi il flusso delle intersezioni TWSC risulta più basso rispetto a quelle AWSC, poichè la strada secondaria
è bloccata finchè la principale è occupata.

\begin{figure}[ht]
    \centering
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-base-in-out-flow-ped.png}
        \caption{Modello base}
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-new-in-out-flow-ped.png}
        \caption{Modello esteso}
    \end{subfigure}
    \caption{
        Confronto tra il flusso dei pedoni in entrata e in uscita per ogni intersezione al crescere del numero di pedoni.
    }
    \label{fig:analisi-comparison-in-out-flow-ped}
\end{figure}

Osservando il flusso delle auto (Fig. \ref{fig:analisi-comparison-in-out-flow-car})
viene sempre riscontrato un incremento di flusso all'aumentare del numero di auto.

In questo caso però il flusso in entrata e in uscita non sono perfettamente bilanciati e risultano più sparsi rispetto al flusso dei pedoni.
Inoltre in molte intersezioni il flusso in entrata è maggiore del flusso in uscita.

Nel modello esteso il flusso risulta più basso
probabilmente a causa della gestione delle intersezioni che, combinato all'utilizzo dello \textit{shortest path},
provoca un rallentamento al traffico in uscita che, propagandosi in tutta la rete, abbassa il flusso in tutte le intersezioni.

\begin{figure}[ht]
    \centering
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-base-in-out-flow-car.png}
        \caption{Modello base}
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=\textwidth]{images/analisi/comparison-new-in-out-flow-car.png}
        \caption{Modello esteso}
    \end{subfigure}
    \caption{
        Confronto tra il flusso delle auto in entrata e in uscita per ogni intersezione al crescere del numero di auto.
    }
    \label{fig:analisi-comparison-in-out-flow-car}
\end{figure}

\pagebreak


\subsubsection*{Tempi di Attesa}

Infine, esclusivamente per il modello esteso, vengono analizzati i tempi di attesa nelle intersezioni per le auto,
ovvero il tempo che passa da quando un'auto arriva all'incrocio a quando ottiene il via libera.
Inoltre i tempi sono distinti tra i due tipi di intersezione: AWSC e TWSC.

Come si può vedere nella tabella \ref{tab:analisi-car-delay}, all'aumentare del numero di auto le intersezioni AWSC
hanno tempi medi di attesa più lunghi, mentre le intersezioni TWSC hanno tempi più brevi, ad eccezione del caso 25\%.

Per quanto riguarda le intersezioni TWSC, i tempi di attesa massimi sono più alti rispetto agli AWSC in tutti i casi,
per via della presenza degli stop nelle strade secondarie.

\begin{table}[ht]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|}
        \hline
             & 25\% cars & 50\% cars & 75\% cars & 100\% cars & intersection \\ \hline
        mean & 36 s      & 56 s      & 142 s     & 185 s      & AWSC         \\ \hline
        max  & 223 s     & 209 s     & 962 s     & 1363 s     & AWSC         \\ \hline
        mean & 35 s      & 111 s     & 170 s     & 262 s      & TWSC         \\ \hline
        max  & 451 s     & 1136 s    & 1246 s    & 1400 s     & TWSC         \\ \hline
    \end{tabular}
    \caption{Confronto dei tempi di attesa massimi e medi per i due tipi di intersezioni al variare della percentuale di auto considerate.}
    \label{tab:analisi-car-delay}
\end{table}

Nella figura \ref{fig:analisi-comparison-car-delay} vengono riportati i tempi di attesa nella rete al variare del numero di auto.

Al crescere del numero di auto si può notare come la zona in alto vicino al mare composta da una serie di TWSC abbia tempi di attesa più
alti.

Spazialmente si può notare che la maggior parte delle intersezioni con tempi di attesa elevati si trovano vicino al mare.

\begin{figure}[ht]
    \includegraphics[width=1\textwidth]{images/analisi/comparison-car-delay.png}
    \caption{Tempi di attesa nelle intersezioni al variare del numero di auto, differenziando AWSC (triangoli) e TWSC (cerchi).}
    \label{fig:analisi-comparison-car-delay}
\end{figure}



\subsection*{Comparazione Modello Base con Modello Wang 2021}

